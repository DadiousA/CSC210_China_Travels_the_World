<html>
    <head>
        <title>wan'U</title>

        <script src="JS-api/jquery-2.1.4.js"></script>
        <script src="JS-api/js.cookie.js"></script>
        <script src="JS-api/jssor.slider.debug.js"></script>
        
        <script>
            function reloadJssor(photos, userEmail) {
                var options = {
                    $DragOrientation: 0,
                    $SlideDuration: 0,
                    $ArrowNavigatorOptions: {
                        $Class: $JssorArrowNavigator$
                    },
                    $ThumbnailNavigatorOptions: {
                        $Class: $JssorThumbnailNavigator$,
                        $Cols: 10,
                        $SpacingX: 8,
                        $SpacingY: 8,
                        $Align: 360
                    }
                };
                var JssorStruct = '<div id="slider" style="position: relative; margin: 0 auto; top: 0px; left: 0px; width: 600px; height: 500px; overflow: hidden; visibility: hidden; background-color: #24262e;"><div data-u="slides" id="slides" style="cursor: default; position: relative; top: 0px; left: 0px; width: 600px; height: 400px; overflow: hidden;"></div></div>';
                var ArrowStruct = '<div data-u="thumbnavigator" class="thumb" style="position:absolute;left:0px;bottom:0px;width:600px;height:100px;" data-autocenter="1"><div data-u="slides" style="cursor: default;"><div data-u="prototype" class="p"><div class="w"><div data-u="thumbnailtemplate" class="t"></div></div><div class="c"></div></div></div></div><span data-u="arrowleft" class="arrowleft" style="top:158px;left:8px;width:40px;height:40px;"></span><span data-u="arrowright" class="arrowright" style="top:158px;right:8px;width:40px;height:40px;"></span>'
                $('#slider').remove();
                $('#showpanel').append(JssorStruct);
                for(i=0;i<photos.length;i++){
                    $('#slides').append('<div data-p="144.50" style="display: none;"><img data-u="image" src="user_files/'+userEmail+'/'+photos[i]+'" /><img data-u="thumb" src="user_files/'+userEmail+'/'+photos[i]+'" /></div>');
                }
                $('#slider').append(ArrowStruct);
                var slider = new $JssorSlider$("slider", options);
                slider.$ScaleHeight($(window).height());
                return slider;
            }

            $(document).ready(function () {
            
                var userEmail = Cookies.get('email');
                var index = location.search.slice(1).split('=')[1];

                window.setInterval(function() {
                    if (Cookies.get('email') == undefined) {
                        $.ajax({
                            url: "/user/"+userEmail,
                            type: "PUT",
                            dataType : "text",
                            success: function( data ) {
                                alert("You need to relog in!");
                                window.location.replace('/');
                            }
                        });
                    }
                }, 500);
            
                window.setInterval(function() {
                    index=sliderobj.$CurrentIndex();
                    $.ajax({
                        url: "/image_desc/"+userEmail+"/"+index,
                        type: "GET",
                        success: function( data ) {
                            if(data) $('#text').html(data);
                                else $('#text').html('click here to enter introduction of this photo!');  
                        }
                    });
                }, 100);

                var sliderobj;

                var buttonlength = $(window).width()-($(window).height())*6/5;
                $(".buttonlength").css("width", buttonlength/2);

                $.ajax({
                    url: "/image/"+userEmail,
                    type: "GET",
                    dataType : "json",

                    success: function( data ) {
                        if(data.photos.length != 0)
                        {
                            sliderobj = reloadJssor(data.photos,userEmail);
                            sliderobj.$GoTo(index);
                        };
                    }
                });

                $("#delete").click(function() {        
                    var t=confirm("I really want to delete this photo.");
                    if (t==1){
                        $.ajax({
                            url: "/image/"+userEmail,
                            type: "DELETE",
                            data: {index: index},
                            dataType : "json",
                            success: function( data ) {
                                sliderobj = reloadJssor(data.photos,userEmail);
                            }
                        });
                    }
                });

                $("#text").click(function() {        
                    var desc = prompt("Enter some description here!", "My description");
                    if(desc!=undefined){
                        $.ajax({
                            url: "/image_desc/"+userEmail,
                            type: "PUT",
                            data: {
                                index: index,
                                description: desc,
                            },
                        });
                    if(desc) $('#text').html(desc); 
                        else $('#text').html('click here to enter introduction of this photo!'); 
                    } 
                });

                $("#home").click(function() {        
                    location.replace('log_in.html');
                });

            });
            
        </script>

    </head>
    <body style="padding:0px; margin:0px; background-color:#fff;">

        <style>
        
        .arrowleft, .arrowright {
            display: block;
            position: absolute;
            width: 40px;
            height: 40px;
            cursor: pointer;
            background: url('options/arrow.png') no-repeat;
            overflow: hidden;
        }
        .arrowleft { background-position: -10px -40px; }
        .arrowright { background-position: -70px -40px; }
        .arrowleft:hover { background-position: -130px -40px; }
        .arrowright:hover { background-position: -190px -40px; }
        .arrowleft.arrowleftdn { background-position: -250px -40px; }
        .arrowright.arrowrightdn { background-position: -310px -40px; }

        .thumb .p {
            position: absolute;
            top: 0;
            left: 0;
            width: 72px;
            height: 72px;
        }
        
        .thumb .t {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .thumb .w {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 100%;
            height: 100%;
        }
        
        .thumb .c {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 68px;
            height: 68px;
            border: #000 2px solid;
            box-sizing: content-box;
            background: url('options/thumb.png') -800px -800px no-repeat;
            _background: none;
        }
        
        .thumb .pav .c {
            top: 2px;
            _top: 0px;
            left: 2px;
            _left: 0px;
            width: 68px;
            height: 68px;
            border: #000 0px solid;
            _border: #fff 2px solid;
            background-position: 50% 50%;
        }
        
        .thumb .p:hover .c {
            top: 0px;
            left: 0px;
            width: 70px;
            height: 70px;
            border: #fff 1px solid;
            background-position: 50% 50%;
        }
        
        .thumb .p.pdn .c {
            background-position: 50% 50%;
            width: 68px;
            height: 68px;
            border: #000 2px solid;
        }
        
        * html .thumb .c, * html .thumb .pdn .c, * html .thumb .pav .c {
            width: 72px;
            height: 72px;
        }
        
        </style>

        <button id='text' class="buttonlength" style="position: fixed;left:0px;top:0px;height: 100%;color: black; font-size: 30px;font-family: 'Comic Sans MS';background-color: #ccffff; border-width: 0px">click here to enter introduction of this photo!</button>
        <button id='home' class="buttonlength" style="position: fixed;right:0px;top:0px;height: 50%;color: black; font-size: 80px;font-family: 'Comic Sans MS';background-color: #33cc33; border-width: 10px;">home page</button>
        <button id='delete' class="buttonlength" style="position: fixed;right:0px;bottom:0px;height: 50%;color: black; font-size: 80px;font-family: 'Comic Sans MS';background-color: #ff3300; border-width: 10px;">delete photo</button>

        <div id='showpanel'></div>

    </body>
</html>
