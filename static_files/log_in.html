<html>
  <head>
    <title>Wan'U</title>
    <style type="text/css">
      body {
        background-image:url("background.gif");
        background-repeat: no-repeat;
        background-size: 100% 100%;
      }
      .picture_scroller>img {
        position: relative;
        height: 80%;
        margin-top: 20px;
        margin-bottom: 20px;
        margin-left: 20px;
        margin-right: 20px;
        border: 5px solid white;
      }
      #header {
        color: black;
        font-size: 50px;
        font-family: "Lucida Console";
        margin: 20px;
      }
      i{
        font-size: 70px;
        font-family: "Verdana";
        font-style: normal;
        font-weight: bold;
      }
      #upper-right{
         overflow: auto;
        padding-top: 15px;
        position: absolute;
        width: 40%;
        right: 20px;
        top: 50px;
      }
      .whole_pref_container{
       
        background-color:rgba(50,200,50,0.3);
        width: 70%;
        float: left;
      }
      #logout_container{
        margin: auto;
        clear: left;
        width: 30%;
        float: left;
        opacity: 1;
      }
      .pref_container{
        clear: both;
        margin: 10px auto;
        height: 80%;
        top: 30px;
      }
      #pref_main_label{
        text-align:center;
        font-size: 30px;
        font-family: "Verdana";
        font-style: normal;
        font-weight: bold;
      }
      .pref_form{
        width: 100%;
      }
      .pref_label{
        padding: 5px;
        margin:5px;
        float: left;
        clear: left; 
        font-family: "Verdana";
        font-weight: bold;
        font-size: 20px;
        width: 50%;
        text-align:center;
      }
      .form-control{
        font-family: "Verdana";
        margin: 5px;
        padding: 5px;
        border: 3px solid #DDDDDD;
        float: left;
        clear: right; 
        font-size: 20px;
        width: 40%;
        text-align:center;
      }
      #time{
        position: absolute;
        right: 5px;
        top: 10px;
        font-size: 15px;
      }
      #blog{
        font-family: "Times New Roman";
        font-size: 30px;
        padding: 15px;
        font-weight: bold;
      }
      .picture_holder{
        background-color:rgba(50,200,50,0.3);
        position: absolute;
        width: 100%;
        bottom: 100px;
        height: 50%;
      }
      .picture_scroller{
        background-color:rgba(50,200,50,0.3);
        position: relative;
        width: 100%;
        height: 90%;
      }
      #logout{
        width: 80%;
      }
      #logout:hover{
        background-color:rgba(51,153,255,0.6);
      }
      div.photo {
        position: fixed;
        bottom: 0;
        left: 20px;
        width: 300px;
        /*border: 3px solid #73AD21;*/
      }
    </style>
    <script src="JS-api/jquery-2.1.4.js"></script>
    <script src="JS-api/js.cookie.js"></script>

    <script type="text/javascript">
            // readMe Cookie
      $(document).ready(function() {


        var userEmail = Cookies.get('email');
        var userName = "";

        $.ajax({
          url: "user_pref/"+userEmail,
          type: "GET",
          dataType : "json",

          success: function( data ) {
            $("#language").val(data.language);
            $("#city").val(data.city);
            userName = data.name;
            $("#header").html("Welcome back, <i>" +userName+'</i>.');
          },
        });

        $("#time").val("Current time: " + new Date()+'.');
        setInterval(function(){$("#time").html("Current time: " + new Date()+'.');}, 1000);

        $("#logout").click(function() {        
          $.ajax({
            url: "user/"+userEmail,
            type: "PUT",
            dataType : "text",
            success: function( data ) {
                Cookies.remove('email');
                window.location.replace('index.html');
            }
          });
        });

        $( ".pref_form" ).focusout(function() {
          $.ajax({
            url: "user_pref/",
            type: "POST",
            dataType : "text",

            data : {  email: userEmail,
                      language: $("#language").val(),
                      city: $("#city").val(),
                    },
          });
        });

        // http://stackoverflow.com/questions/21044798/how-to-use-formdata-for-ajax-file-upload
        $('#submitPhoto').click(function(){
          var formData = new FormData(document.getElementById("ADD"));
          $.ajax({
            url: '/image/'+userEmail,
            contentType: false,
            processData: false,
            enctype: "multipart/form-data",
            data: formData,
            type: 'POST',

            success: function( data ) {
              alert(data);
              var inputFile = $("#inputFile");
              inputFile.replaceWith( inputFile = inputFile.clone( true ) );
            },
          });
          
        }); 



      });
    </script>
  </head>
  
  <body>
    <h1 id='header'>Welcome</h1>
    
    <div class='picture_holder'>
      <div id="blog">My Album:</div>
      <div class="picture_scroller">
        <img src="istanbul.jpg"/></li>
        <img src="jerusalem.jpg"/></li>
      </div>
    </div>

    <div id='time'></div>

    <div id='upper-right'>
      <div id='logout_container'>
        <img id='logout' src="logout.png">
      </div>
  
      <div class="whole_pref_container">
        <div id='pref_main_label'>Personal Preferences</div>
        <div class="pref_container">
          <div class="pref_form">
            <label class='pref_label'>language:</label>
            <input type="text" class="form-control" id="language" placeholder="Enter language">
          </div>
          <div class="pref_form">
            <label class='pref_label'>City:</label>
            <input type="text" class="form-control" id="city" placeholder="Enter city">
          </div>
        </div>
      </div>
    </div>

    <div class="photo">
      <form  id="ADD">
        <div>Add to my album:</div>
        <input type="file" id="inputFile" name="image"/> 
        <input type="button" value ="submit!" id="submitPhoto"/>
      </form>
    </div>

  </body>
</html>
<!--
/*
  $("#updateButton").click(function() {
    $.ajax({
      // The URL for the request - note the simple REST API!
      // all URLs are relative to http://localhost:3000/
      url: "users/" + $("#nameBox").val(),
      type: "PUT",
      dataType : "text", // this URL returns a plain text string, not JSON

      data : { job: $("#jobBox").val(),
               pet: $("#petBox").val()
             },

      success: function( data ) {
        console.log("You received some data!", data);
        if (data == 'OK') {
          $("#status").html("Successfully updated user");
        } else {
          $("#status").html("Error: could not update user");
        }
      },
    });
  });

  $("#deleteButton").click(function() {
    $.ajax({
      // The URL for the request - note the simple REST API!
      // all URLs are relative to http://localhost:3000/
      url: "users/" + $("#nameBox").val(),
      type: "DELETE",
      dataType : "text", // this URL returns a plain text string, not JSON

      success: function( data ) {
        console.log("You received some data!", data);
        if (data == 'OK') {
          $("#status").html("Successfully deleted!");
        } else {
          $("#status").html("Error: could not delete!");
        }
      },
    });
  });
  */

-->