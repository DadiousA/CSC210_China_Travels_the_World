<html>
  <head>
    <title>Wan'U</title>
    <style type="text/css">
      body {
        background-image:url("background.gif");
        background-repeat: no-repeat;
        background-size: 100% 100%;
      }
      img {
        position: relative;
        height: 80%;
        margin-top: 20px;
        margin-bottom: 20px;
        margin-left: 20px;
        margin-right: 20px;
        border: 5px solid white;
      }
      #header {
        color: black;
        font-size: 50px;
        font-family: "Lucida Console";
        margin: 20px;
      }
      i{
        font-size: 70px;
        font-family: "Verdana";
        font-style: normal;
        font-weight: bold;
      }
      .whole_pref_container{
        background-color:rgba(50,200,50,0.3);
        padding-top: 15px;
        position: absolute;
        width: 30%;
        right: 20px;
        top: 50px;
      }
      .pref_container{
        margin: 10px auto;
        height: 80%;
        top: 30px;
      }
      #pref_main_label{
        text-align:center;
        font-size: 30px;
        font-family: "Verdana";
        font-style: normal;
        font-weight: bold;
      }
      .pref_form{
        width: 100%;
      }
      .pref_label{
        padding: 5px;
        margin:5px;
        float: left;
        clear: left; 
        font-family: "Verdana";
        font-weight: bold;
        font-size: 20px;
        width: 50%;
        text-align:center;
      }
      .form-control{
        font-family: "Verdana";
        margin: 5px;
        padding: 5px;
        border: 3px solid #DDDDDD;
        float: left;
        clear: right; 
        font-size: 20px;
        width: 40%;
        text-align:center;
      }
      #time{
        position: absolute;
        right: 5px;
        top: 10px;
        font-size: 15px;
      }
      #blog{
        font-family: "Times New Roman";
        font-size: 30px;
        padding: 15px;
        font-weight: bold;
      }
      .picture_holder{
        background-color:rgba(50,200,50,0.3);
        position: absolute;
        width: 100%;
        bottom: 100px;
        height: 50%;
      }
      .picture_scroller{
        background-color:rgba(50,200,50,0.3);
        position: relative;
        width: 100%;
        height: 90%;
      }
      div.photo {
        position: fixed;
        bottom: 0;
        left: 20px;
        width: 300px;
        /*border: 3px solid #73AD21;*/
}
    </style>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

    <script type="text/javascript">
            // readMe Cookie
       

      $(document).ready(function() {

         function readCookie(name) {
          var nameEQ = name + "=";
          var ca = document.cookie.split(';');
          for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
          }
          return null;
        };
        
        var user =readCookie('user');

        $.ajax({
            url: "user_pref/"+user,
            type: "GET",
            dataType : "json",

            success: function( data ) {
              $("#language").val(data.language);
              $("#city").val(data.city);
            },
          });


        $("#time").val("Current time: " + new Date()+'.');
        setInterval(function(){$("#time").html("Current time: " + new Date()+'.');}, 1000);

        $("#header").html("Welcome back, <i>" +user+'</i>.');


        $( ".pref_form" ).focusout(function() {
          $.ajax({
            url: "user_pref/",
            type: "POST",
            dataType : "text",

            data : {  name: readCookie('user'),
                      language: $("#language").val(),
                      city: $("#city").val(),
                    },
          });
        });

        // http://stackoverflow.com/questions/21044798/how-to-use-formdata-for-ajax-file-upload
        $('#ADD').on('submit', function(){
        console.log("submitted");
       // console.log("length:"+document.forms[0].length);
        var formData=new FormData(this);

        console.log("submitting");

          $.ajax({
            url         : '/image',
            contentType: false,
            processData: false,
            enctype: "multipart/form-data",
            data        : formData,
            type        : 'POST',
         //   dataType    : 'text/plain',

            success: function( data ) {
            console.log("You received some data!");
            },
            // Code to run if the request fails
           // error: function() {
          //  alert( "Sorry, there was a problem!" );
          //  } 

            });

        console.log("yeah");
        }); 

});
</script>
</head>
  
  <body>
    <h1 id='header'>Welcome</h1>
    
    <div class='picture_holder'>
      <div id="blog">My Album:</div>
      <div class="picture_scroller">
        <img src="istanbul.jpg"/></li>
        <img src="jerusalem.jpg"/></li>
      </div>
    </div>

    <div id='time'></div>
  
    <div class="whole_pref_container">
      <div id='pref_main_label'>Personal Preferences</div>
      <div class="pref_container">
        <div class="pref_form">
          <label class='pref_label'>language:</label>
          <input type="text" class="form-control" id="language" placeholder="Enter language">
        </div>
        <div class="pref_form">
          <label class='pref_label'>City:</label>
          <input type="text" class="form-control" id="city" placeholder="Enter city">
        </div>
      </div>
    </div>

<div class="photo">
    <form  id="ADD">
    <div>Add to my album:</div>
    <input type="file" name="image"/> 
    <input type="submit" name ="submit"/>
    </form>
</div>

</body>
</html>
<!--
/*
  $("#updateButton").click(function() {
    $.ajax({
      // The URL for the request - note the simple REST API!
      // all URLs are relative to http://localhost:3000/
      url: "users/" + $("#nameBox").val(),
      type: "PUT",
      dataType : "text", // this URL returns a plain text string, not JSON

      data : { job: $("#jobBox").val(),
               pet: $("#petBox").val()
             },

      success: function( data ) {
        console.log("You received some data!", data);
        if (data == 'OK') {
          $("#status").html("Successfully updated user");
        } else {
          $("#status").html("Error: could not update user");
        }
      },
    });
  });

  $("#deleteButton").click(function() {
    $.ajax({
      // The URL for the request - note the simple REST API!
      // all URLs are relative to http://localhost:3000/
      url: "users/" + $("#nameBox").val(),
      type: "DELETE",
      dataType : "text", // this URL returns a plain text string, not JSON

      success: function( data ) {
        console.log("You received some data!", data);
        if (data == 'OK') {
          $("#status").html("Successfully deleted!");
        } else {
          $("#status").html("Error: could not delete!");
        }
      },
    });
  });
  */

-->